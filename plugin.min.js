// Change to the timeline widget ID on your account
var timeline_widget_id = '600724936517242880';

tinymce.PluginManager.add('twitter_widgets', function(editor, url){
    // Add a button that opens a window
    editor.addButton('twitter_widgets', {
        tooltip: "Twitter Widget",
        image: url + '/img/twitter_logo.png',
        onclick: function() {
            // Open window
            editor.windowManager.open({
                title: 'Twitter Widget',
                body: [
                    {type: 'container', html: '<p>Insert a user\'s timeline.</p><p><small>Timeline will show up as "Tweets by @your_username" in the editor.</small></p>'},
                    {type: 'textbox', name: 'username', label: '@'}
                ],
                onsubmit: function(e) {
                    // Insert content when the window form is submitted
                    editor.insertContent('<a class="twitter-timeline" href="https://twitter.com/' + e.data.username + '" data-widget-id="' + timeline_widget_id + '" data-screen-name="' + e.data.username + '">Tweets by @' + e.data.username + '</a>');
                }
            });
        }
    });
});